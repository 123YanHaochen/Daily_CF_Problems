**提示 1：** 如果我们固定选择的攻击武器，则我们选择不同的防具分别最大带来多大的收益呢？

**提示 2：** 尝试枚举攻击的武器，如何让选取防具的收益变得容易更新？

有两项东西要选择的时候，往往可以考虑固定其中一个，这里我们也采取对应的思路。

首先，我们选取攻击的武器。

那么，我们只需考虑防御力严格低于之的所有怪物。

接下来，选取防具带来的收益如何呢？对于每个防具，我们只需计算攻击力更弱的所有怪物的总价值。

到这里，我们大概就知道整体是如何贪心的了。接下来如何对于不同的攻击武器，计算出最优的收益。

为了使得考虑的怪物每次调整较小，我们可以选择 **按照攻击力升序，考虑每个攻击武器** ，这样下来，我们相当于不断新增怪物。

而新增一个怪物如何收益情况呢？这就相当于更新不同防具的收益。

而新增一个怪物相当于对于防御力高于之的所有防具增加一定收益。也就是对于大于等于 $x$ 的位置增加一个 $add$ 。

同时，最后我们要取所有防具对应的收益的最大值。

综合上述两点，可以考虑使用懒更新线段树，进行区间加和区间最大值的操作。

具体而言，对于每个防具，一开始只记录成本，而后续操作带来收益，用区间加进行更新，最后取全局最大值即可。

通过上述枚举攻击武器的过程，一定覆盖了最终答案，于是本题得解。

时间复杂度为 $\mathcal{O}(n\log n+m\log m+p(\log m+\log p))$ 。